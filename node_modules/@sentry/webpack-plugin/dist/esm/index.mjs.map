{"version":3,"file":"index.mjs","sources":["../../src/index.ts"],"sourcesContent":["import {\n  getDebugIdSnippet,\n  Options,\n  sentryUnpluginFactory,\n  stringToUUID,\n  SentrySDKBuildFlags,\n} from \"@sentry/bundler-plugin-core\";\nimport * as path from \"path\";\nimport { UnpluginOptions } from \"unplugin\";\nimport { v4 as uuidv4 } from \"uuid\";\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore webpack is a peer dep\nimport * as webback4or5 from \"webpack\";\n\ninterface BannerPluginCallbackArg {\n  chunk?: {\n    hash?: string;\n  };\n}\n\nfunction webpackReleaseInjectionPlugin(injectionCode: string): UnpluginOptions {\n  return {\n    name: \"sentry-webpack-release-injection-plugin\",\n    webpack(compiler) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore webpack version compatibility shenanigans\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n      const BannerPlugin =\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore webpack version compatibility shenanigans\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        compiler?.webpack?.BannerPlugin ||\n        webback4or5?.BannerPlugin ||\n        webback4or5?.default?.BannerPlugin;\n      compiler.options.plugins = compiler.options.plugins || [];\n      compiler.options.plugins.push(\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-call\n        new BannerPlugin({\n          raw: true,\n          include: /\\.(js|ts|jsx|tsx|mjs|cjs)$/,\n          banner: injectionCode,\n        })\n      );\n    },\n  };\n}\n\nfunction webpackBundleSizeOptimizationsPlugin(\n  replacementValues: SentrySDKBuildFlags\n): UnpluginOptions {\n  return {\n    name: \"sentry-webpack-bundle-size-optimizations-plugin\",\n    webpack(compiler) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore webpack version compatibility shenanigans\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n      const DefinePlugin =\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore webpack version compatibility shenanigans\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        compiler?.webpack?.DefinePlugin ||\n        webback4or5?.DefinePlugin ||\n        webback4or5?.default?.DefinePlugin;\n      compiler.options.plugins = compiler.options.plugins || [];\n      compiler.options.plugins.push(\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-call\n        new DefinePlugin({\n          ...replacementValues,\n        })\n      );\n    },\n  };\n}\n\nfunction webpackDebugIdInjectionPlugin(): UnpluginOptions {\n  return {\n    name: \"sentry-webpack-debug-id-injection-plugin\",\n    webpack(compiler) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore webpack version compatibility shenanigans\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n      const BannerPlugin =\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore webpack version compatibility shenanigans\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        compiler?.webpack?.BannerPlugin ||\n        webback4or5?.BannerPlugin ||\n        webback4or5?.default?.BannerPlugin;\n      compiler.options.plugins = compiler.options.plugins || [];\n      compiler.options.plugins.push(\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-call\n        new BannerPlugin({\n          raw: true,\n          include: /\\.(js|ts|jsx|tsx|mjs|cjs)$/,\n          banner: (arg?: BannerPluginCallbackArg) => {\n            const debugId = arg?.chunk?.hash ? stringToUUID(arg.chunk.hash) : uuidv4();\n            return getDebugIdSnippet(debugId);\n          },\n        })\n      );\n    },\n  };\n}\n\nfunction webpackDebugIdUploadPlugin(\n  upload: (buildArtifacts: string[]) => Promise<void>\n): UnpluginOptions {\n  const pluginName = \"sentry-webpack-debug-id-upload-plugin\";\n  return {\n    name: pluginName,\n    webpack(compiler) {\n      compiler.hooks.afterEmit.tapAsync(pluginName, (compilation, callback: () => void) => {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        const outputPath = (compilation.outputOptions.path as string | undefined) ?? path.resolve();\n        const buildArtifacts = Object.keys(compilation.assets as Record<string, unknown>).map(\n          (asset) => path.join(outputPath, asset)\n        );\n        void upload(buildArtifacts).then(() => {\n          callback();\n        });\n      });\n    },\n  };\n}\n\nfunction webpackModuleMetadataInjectionPlugin(injectionCode: string): UnpluginOptions {\n  return {\n    name: \"sentry-webpack-module-metadata-injection-plugin\",\n    webpack(compiler) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore webpack version compatibility shenanigans\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n      const BannerPlugin =\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore webpack version compatibility shenanigans\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        compiler?.webpack?.BannerPlugin ||\n        webback4or5?.BannerPlugin ||\n        webback4or5?.default?.BannerPlugin;\n      compiler.options.plugins = compiler.options.plugins || [];\n      compiler.options.plugins.push(\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-unsafe-call\n        new BannerPlugin({\n          raw: true,\n          include: /\\.(js|ts|jsx|tsx|mjs|cjs)$/,\n          banner: injectionCode,\n        })\n      );\n    },\n  };\n}\n\nconst sentryUnplugin = sentryUnpluginFactory({\n  releaseInjectionPlugin: webpackReleaseInjectionPlugin,\n  moduleMetadataInjectionPlugin: webpackModuleMetadataInjectionPlugin,\n  debugIdInjectionPlugin: webpackDebugIdInjectionPlugin,\n  debugIdUploadPlugin: webpackDebugIdUploadPlugin,\n  bundleSizeOptimizationsPlugin: webpackBundleSizeOptimizationsPlugin,\n});\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const sentryWebpackPlugin: (options: Options) => any = sentryUnplugin.webpack;\n\nexport { sentryCliBinaryExists } from \"@sentry/bundler-plugin-core\";\nexport type { Options as SentryWebpackPluginOptions } from \"@sentry/bundler-plugin-core\";\n"],"names":["webpackReleaseInjectionPlugin","injectionCode","name","webpack","compiler","_compiler$webpack","_webback4or5$default","BannerPlugin","webback4or5","options","plugins","push","raw","include","banner","webpackBundleSizeOptimizationsPlugin","replacementValues","_compiler$webpack2","_webback4or5$default2","DefinePlugin","_objectSpread","webpackDebugIdInjectionPlugin","_compiler$webpack3","_webback4or5$default3","arg","_arg$chunk","debugId","chunk","hash","stringToUUID","uuidv4","getDebugIdSnippet","webpackDebugIdUploadPlugin","upload","pluginName","hooks","afterEmit","tapAsync","compilation","callback","_ref","outputPath","outputOptions","path","resolve","buildArtifacts","Object","keys","assets","map","asset","join","then","webpackModuleMetadataInjectionPlugin","_compiler$webpack4","_webback4or5$default4","sentryUnplugin","sentryUnpluginFactory","releaseInjectionPlugin","moduleMetadataInjectionPlugin","debugIdInjectionPlugin","debugIdUploadPlugin","bundleSizeOptimizationsPlugin","sentryWebpackPlugin"],"mappings":"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"}